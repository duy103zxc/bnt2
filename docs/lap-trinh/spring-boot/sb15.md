[SB15] Exception Handling @ExceptionHandler + @RestControllerAdvice / @ControllerAdvice + @ResponseStatus
=========================================================================================================

- Giá»›i thiá»‡u
- @RestControllerAdvice & @ControllerAdvice + @ExceptionHandler
- @ResponseStatus
- Demo
- CÃ i Ä‘áº·t
- Táº¡o model
- Táº¡o Controller
- Táº¡o Exception Handler
- Cháº¡y thá»­
- Káº¿t

### **Giá»›i thiá»‡u**

Trong bÃ i trÆ°á»›cÂ chÃºng ta Ä‘Ã£ biáº¿t cÃ¡ch lÃ m má»™t Rest Api Server vá»›iÂ **Spring Boot**.

1. [ğŸ–Šï¸SB14] Restful API + @RestController + @PathVariable + @RequestBody

Tuy nhiÃªn cÃ³ má»™t sá»‘ váº¥n Ä‘á» mÃ  chÃºng ta kiá»ƒm soÃ¡t. VÃ­ dá»¥ nhÆ° náº¿u ngÆ°á»i dÃ¹ng request lÃªn má»™tÂ `id`Â khÃ´ng há» tá»“n táº¡i thÃ¬ sao?

!image

Trong bÃ i viáº¿t nÃ y, chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch xá»­ lÃ½ Exception trongÂ **Spring Boot**

### **@RestControllerAdvice & @ControllerAdvice + @ExceptionHandler**

`@RestControllerAdvice`Â lÃ  má»™t Annotation gáº¯n trÃªn Class. CÃ³ tÃ¡c dá»¥ng xen vÃ o quÃ¡ trÃ¬nh xá»­ lÃ½ cá»§a cÃ¡cÂ `@RestController`. TÆ°Æ¡ng tá»± vá»›iÂ `@ControllerAdvice`

`@RestControllerAdvice`Â thÆ°á»ng Ä‘Æ°á»£c káº¿t há»£p vá»›iÂ `@ExceptionHandler`Â Ä‘á»ƒ cáº¯t ngang quÃ¡ trÃ¬nh xá»­ lÃ½ cá»§a Controller, vÃ  xá»­ lÃ½ cÃ¡c ngoáº¡i lá»‡ xáº£y ra.

```
@RestControllerAdvice
public class ApiExceptionHandler {

    @ExceptionHandler(IndexOutOfBoundsException.class)
    @ResponseStatus(value = HttpStatus.BAD_REQUEST)
    public ErrorMessage TodoException(Exception ex,  WebRequest request) {
        return new ErrorMessage(10100, "Äá»‘i tÆ°á»£ng khÃ´ng tá»“n táº¡i");
    }
}
```

Hiá»ƒu Ä‘Æ¡n giáº£n lÃ  Controller Ä‘ang hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng, cháº³ng may cÃ³ má»™t Exception Ä‘Æ°á»£c nÃ©m ra, thÃ¬ thay vÃ¬ bÃ¡o lá»—i há»‡ thá»‘ng, thÃ¬ nÃ³ sáº½ Ä‘Æ°á»£c tháº±ngÂ `@RestControllerAdvice`Â vÃ Â `@ExceptionHandler`Â Ä‘Ã³n láº¥y vÃ  xá»­ lÃ½. Sau Ä‘Ã³ tráº£ vá» cho ngÆ°á»i dÃ¹ng thÃ´ng tin há»¯u Ã­ch hÆ¡n.

### **@ResponseStatus**

`@ResponseStatus`Â lÃ  má»™t cÃ¡ch Ä‘á»‹nh nghÄ©a Http Status tráº£ vá» cho ngÆ°á»i dÃ¹ng.

Náº¿u báº¡n khÃ´ng muá»‘n sá»­ dá»¥ngÂ `ResponseEntity`Â thÃ¬ cÃ³ thá»ƒ dÃ¹ngÂ `@ResponseStatus`Â Ä‘Ã¡nh dáº¥u trÃªnÂ `Object`Â tráº£ vá».

### **Demo**

### **CÃ i Ä‘áº·t**

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.5.RELEASE</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>me.loda.spring</groupId>
    <artifactId>spring-boot-learning</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>spring-boot-learning</name>
    <description>Everything about Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>

        <!--spring mvc, rest-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
        </plugins>
    </build>

</project>
```

Cáº¥u trÃºc thÆ° má»¥c:

!image

### **Táº¡o model**

Sá»­ dá»¥ngÂ LombokÂ cho tiá»‡n nha cÃ¡c báº¡n.

_Todo.java_

```
@Data
@AllArgsConstructor
public class Todo {
    private String title;
    private String detail;
}
```

Táº¡o ra classÂ `ErrorMessage`Â Ä‘á»ƒ chá»©a thÃ´ng tin tráº£ vá» cho Client.

_ErrorMessage.java_

```
@Data
@AllArgsConstructor
public class ErrorMessage {
    private int statusCode;
    private String message;
}
```

### **Táº¡o Controller**

_RestApiController.java_

```
/**
 * LÆ°u Ã½, @RequestMapping á»Ÿ class, sáº½ tÃ¡c Ä‘á»™ng tá»›i
 * táº¥t cáº£ cÃ¡c RequestMapping á»Ÿ bÃªn trong nÃ³.
 * <p>
 * Má»i Request á»Ÿ trong method sáº½ Ä‘Æ°á»£c gáº¯n thÃªm prefix /api/v1
 */
@RestController
@RequestMapping("/api/v1")
public class RestApiController {

    private List<Todo> todoList;

    // báº¡n cÃ²n nhá»› @PostConstruct dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ chá»©?
    // náº¿u khÃ´ng nhá»›, hÃ£y coi láº¡i bÃ i viáº¿t Spring Boot #3 nhÃ©
    @PostConstruct
    public void init() {
        todoList = IntStream.range(0, 10)
                 .mapToObj(i -> new Todo("title-" + i, "detail-" + i))
                 .collect(Collectors.toList());
    }

    /*
    pháº§n path URL báº¡n muá»‘n láº¥y thÃ´ng tin sáº½ Ä‘á»ƒ trong ngoáº·c kÃ©p {}
     */
    @GetMapping("/todo/{todoId}")
    public Todo getTodo(@PathVariable(name = "todoId") Integer todoId) {
        // @PathVariable láº¥y ra thÃ´ng tin trong URL
        // dá»±a vÃ o tÃªn cá»§a thuá»™c tÃ­nh Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong ngoáº·c kÃ©p /todo/{todoId}
        return todoList.get(todoId);
    }
}
```

### **Táº¡o Exception Handler**

_ApiExceptionHandler.java_

```
@RestControllerAdvice
public class ApiExceptionHandler {

    /**
     * Táº¥t cáº£ cÃ¡c Exception khÃ´ng Ä‘Æ°á»£c khai bÃ¡o sáº½ Ä‘Æ°á»£c xá»­ lÃ½ táº¡i Ä‘Ã¢y
     */
    @ExceptionHandler(Exception.class)
    @ResponseStatus(value = HttpStatus.INTERNAL_SERVER_ERROR)
    public ErrorMessage handleAllException(Exception ex, WebRequest request) {
        // quÃ¡ trÃ¬nh kiá»ƒm soat lá»—i diá»…n ra á»Ÿ Ä‘Ã¢y
        return new ErrorMessage(10000, ex.getLocalizedMessage());
    }

    /**
     * IndexOutOfBoundsException sáº½ Ä‘Æ°á»£c xá»­ lÃ½ riÃªng táº¡i Ä‘Ã¢y
     */
    @ExceptionHandler(IndexOutOfBoundsException.class)
    @ResponseStatus(value = HttpStatus.BAD_REQUEST)
    public ErrorMessage TodoException(Exception ex, WebRequest request) {
        return new ErrorMessage(10100, "Äá»‘i tÆ°á»£ng khÃ´ng tá»“n táº¡i");
    }
}
```

### **Cháº¡y thá»­**

_App.java_

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

Gá»­i request tá»›i Ä‘á»‹a chá»‰:

```
GEThttp://localhost:8080/api/v1/todo/11
```

á» Ä‘Ã¢y, Ä‘á»‘i tÆ°á»£ng 11 khÃ´ng tá»“n táº¡i trong danh sÃ¡ch, chÃºng ta sáº½ tráº£ vá» lá»—i cho phÃ­a Client.

!image

### **Káº¿t**

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

