[SB10] @RequestMapping + @PostMapping + @ModelAttribute + @RequestParam + Web To-Do vá»›i Thymeleaf
===================================================================================================

- Giá»›i thiá»‡u
- @PostMapping
- @RequestMapping
- Website To-do
- CÃ i Ä‘áº·t
- Táº¡o model
- GET /listTodo - Láº¥y danh sÃ¡ch cÃ¡c viá»‡c cáº§n lÃ m
- GET /addTodo - Trang thÃªm cÃ´ng viá»‡c
- POST /addTodo - ThÃªm cÃ´ng viá»‡c vÃ o list
- Cháº¡y chÆ°Æ¡ng trÃ¬nh.
- Káº¿t

### **Giá»›i thiá»‡u**

Trong bÃ i hÃ´m nay chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch handle request POST cá»§aÂ **Spring Boot**.

TrÆ°á»›c Ä‘Ã³, báº¡n nÃªn biáº¿t

1. [ğŸ“SB8] Táº¡o Web Helloworld vá»›i @Controller + Thymeleaf
2. [ğŸ§µSB9] Giáº£i thÃ­ch cÃ¡ch Thymeleaf váº­n hÃ nh + Expression + Demo Full

### **@PostMapping**

`@PostMapping`Â cÃ³ nhiá»‡m vá»¥ Ä‘Ã¡nh dáº¥u hÃ m xá»­ lÃ½ POST request trong Controller.

KhÃ¡i niá»‡m vá»Â `GET`Â vÃ Â `POST`Â hi vá»ng cÃ¡c báº¡n Ä‘Ã£ biáº¿t rá»“i vÃ  tÃ´i sáº½ khÃ´ng Ä‘á» cáº­p thÃªm trong bÃ i nÃ y. CÃ²n náº¿u chÆ°a biáº¿t báº¡n cÃ³ thá»ƒÂ tham kháº£o táº¡i wiki: Hypertext Transfer Protocol

VÃ­ dá»¥:

TÃ´i cÃ³ 2 hÃ m xá»­ lÃ½, má»™t choÂ `GET`Â method vÃ  má»™t choÂ `POST`.

Cáº£ hai Ä‘á»u chung Ä‘Æ°á»ng dáº«n nhÆ°ng báº¡n nÃªn biáº¿t ráº±ng cÃ¹ng má»™tÂ `path`Â nhÆ°ng khÃ¡cÂ `method`Â thÃ¬ sáº½ xá»­ lÃ½ khÃ¡c nhau.

```
@Controller
public class WebController {
    @GetMapping("/addTodo")
    public String addTodo(Model model) {
        return "addTodo";
    }

    @PostMapping("/addTodo")
    public String addTodo(Model model) {
        return "success";
    }
}
```

Tá»« Ä‘Ã¢y báº¡n cÃ³ thá»ƒ suy ra cÃ¡ch handle cho cÃ¡c method khÃ¡c nhÆ°Â `PUT`,Â `DELETE`, v.v..

1. `@PutMapping`
2. `@DeleteMapping`

### **@RequestMapping**

Trong trÆ°á»ng há»£p báº¡n muá»‘n táº¥t cáº£ cÃ¡c method Ä‘á»u dÃ¹ng chung má»™t cÃ¡ch xá»­ lÃ½ thÃ¬ cÃ³ thá»ƒ sá»­ dá»¥ng AnnotationÂ `@RequestMapping`.

`@RequestMapping`Â lÃ  má»™t annotation cÃ³ Ã½ nghÄ©a vÃ  má»¥c Ä‘Ã­ch sá»­ dá»¥ng rá»™ng hÆ¡n cÃ¡c loáº¡iÂ `@GetMapping`,Â `@PostMapping`,v.v..

vÃ­ dá»¥:

```
@Controller
@RequestMapping("api/v1")
public class WebController {

    // ÄÆ°á»ng dáº«n lÃºc nÃ y lÃ : /api/v1/addTodo vÃ  method GET
    @RequestMapping(value = "/addTodo", method = RequestMethod.GET)
    public String addTodo(Model model) {
        return "addTodo";
    }

    // ÄÆ°á»ng dáº«n lÃºc nÃ y lÃ : /api/v1/addTodo vÃ  method POST
    @RequestMapping(value = "/addTodo", method = RequestMethod.POST)
    public String addTodo(@ModelAttribute Todo todo) {
        return "success";
    }
}
```

Náº¿u khÃ´ng chá»‰ Ä‘á»‹nh method choÂ `@RequestMapping`Â thÃ¬ nÃ³ sáº½ nháº­n toÃ n bá»™ cÃ¡c method.

### **Website To-do**

Váº«n cÃ²n má»™t vÃ i kiáº¿n thá»©c tÃ´i cáº§n giá»›i thiá»‡u vá»›i cÃ¡c báº¡n.

Tuy nhiÃªn tÃ´i sáº½ sá»­ dá»¥ng vÃ­ dá»¥ Ä‘á»ƒ giÃºp báº¡n hiá»ƒu nÃ³ nhanh hÆ¡n.

ChÃºng ta sáº½ lÃ m má»™t WebApp quáº£n lÃ½ cÃ´ng viá»‡c vÃ  tá»« Ä‘Ã³ tÃ¬m hiá»ƒu cÃ¡ch gá»­i dá»¯ liá»‡u lÃªn Server thÃ´ng qua 2 methodÂ `GET`Â vÃ Â `POST`.

### **CÃ i Ä‘áº·t**

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.5.RELEASE</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>me.loda.spring</groupId>
    <artifactId>spring-boot-learning</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>spring-boot-learning</name>
    <description>Everything about Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>

        <!--spring mvc, rest-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <!-- thymeleaf -->
        <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
        </plugins>
    </build>

</project>
```

Cáº¥u trÃºc thÆ° má»¥c:

!image

### **Táº¡o model**

ChÃºng ta sáº½ táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng gá»i lÃ Â `Todo`Â Ä‘á»ƒ thá»ƒ hiá»‡n thÃ´ng tin.

_Todo.java_

```
import lombok.Data;

@Data
public class Todo {
    public String title;
    public String detail;
}
```

### **GET /listTodo - Láº¥y danh sÃ¡ch cÃ¡c viá»‡c cáº§n lÃ m**

ChÃºng ta sáº½ dÃ¹ng Ä‘Æ°á»ng dáº«nÂ `/listTodo`Â Ä‘á»ƒ láº¥y ra danh sÃ¡ch viá»‡c cáº§n lÃ m.

Thiáº¿t káº¿ method cho Ä‘Æ°á»ng dáº«nÂ `/listTodo`Â lÃ Â `GET`.

_WebController.java_

```
@Controller
public class WebController {
    // Sá»­ dá»¥ng táº¡m List Ä‘á»ƒ chá»©a danh sÃ¡ch cÃ´ng viá»‡c
    // Thay cho Database.
    // Chá»‰ dÃ¹ng cÃ¡ch nÃ y khi DEMO ^^
    List<Todo> todoList = new CopyOnWriteArrayList<>();

    /*
        @RequestParam dÃ¹ng Ä‘á»ƒ Ä‘Ã¡nh dáº¥u má»™t biáº¿n lÃ  request param trong request gá»­i lÃªn server.
        NÃ³ sáº½ gÃ¡n dá»¯ liá»‡u cá»§a param-name tÆ°Æ¡ng á»©ng vÃ o biáº¿n
     */
    @GetMapping("/listTodo")
    public String index(Model model, @RequestParam(value = "limit", required = false) Integer limit) {
        // Tráº£ vá» Ä‘á»‘i tÆ°á»£ng todoList.
        // Náº¿u ngÆ°á»i dÃ¹ng gá»­i lÃªn param limit thÃ¬ tráº£ vá» sublist cá»§a todoList
        model.addAttribute("todoList", limit != null ? todoList.subList(0, limit) : todoList);

        // Tráº£ vá» template "listTodo.html"
        return "listTodo";
    }
}
```

ThÃ¬ cÃ¡i Ä‘oáº¡nÂ `?limit=2`Â lÃ Â **Request Param**.

**Spring Boot**Â sáº½ tá»± xá»­ lÃ½ vÃ  gÃ¡n sá»‘ 2 vÃ o biáº¿nÂ `Integer limit`Â há»™ chÃºng ta.

Náº¿u chÃºng ta khÃ´ng gá»­i gÃ¬ lÃªn, thÃ¬Â `limit`Â sáº½ lÃ Â `null`.

_listTodo.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
    <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
    <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1>Danh sÃ¡ch viá»‡c cáº§n lÃ m:</h1><ul><!--Duyá»‡t qua toÃ n bá»™ pháº§n tá»­ trong biáº¿n "todoList"-->
      <lith:each="todo : ${todoList}"><!--Vá»›i má»—i pháº§n tá»­, láº¥y ra title vÃ  detail-->
        <spanth:text="*{todo.getTitle()}"></span> : <spanth:text="*{todo.getDetail()}"></span></li></ul><ath:href="@{/addTodo}"class="btn btn-success"> + ThÃªm cÃ´ng viá»‡c</a></body></html>
```

### **GET /addTodo - Trang thÃªm cÃ´ng viá»‡c**

`GET /addTodo`Â sáº½ tráº£ vá» webpage cho ngá»«oi dÃ¹ng nháº­p thÃ´ng tin cÃ´ng viá»‡c vÃ  thÃªm vÃ o danh sÃ¡ch viá»‡c cáº§n lÃ m.

_WebController.java_

```
@GetMapping("/addTodo")
public String addTodo(Model model) {
    // ThÃªm má»›i má»™t Ä‘á»‘i tÆ°á»£ng Todo vÃ o model
    model.addAttribute("todo", new Todo());
    // Tráº£ vá» template addTodo.html
    return "addTodo";
}
```

_addTodo.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
  <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
  <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1>To-do</h1><formth:action="@{/addTodo}"th:object="${todo}"method="post"><p>title: <inputtype="text"th:field="*{title}"/></p><p>detail: <inputtype="text"th:field="*{detail}"/></p><p><buttontype="submit"class="btn btn-success">Add</button></p></form></body></html>
```

`<form></form>`Â lÃ  tháº» tag mÃ  báº¡n cáº§n biáº¿t khi lÃ m Web. NÃ³ táº¡o Request Form gá»­i tá»›i server vá»›i thÃ´ng tin vÃ  cÃ¡c tháº»Â `<input>`Â trong nÃ³.

á» Ä‘Ã¢y, tÃ´i gÃ¡n vÃ oÂ `Model`Â má»™t Ä‘á»‘i tÆ°á»£ngÂ `Todo`.

TrongÂ `form`, chÃºng ta láº¥y ra Ä‘á»‘i tÆ°á»£ngÂ `Todo`Â vÃ  chá»‰ Ä‘á»‹nh bá»ŸiÂ `th:object="${todo}"`

GÃ¡n thÃ´ng tin ngÆ°á»i dÃ¹ng nháº­p vÃ oÂ `Todo`Â báº±ng cÃº phÃ¡pÂ `th:field=*{tÃªn_thuá»™c_tÃ­nh}`.

Báº¥mÂ `Button`Â thÃ¬Â `form`Â sáº½ gá»­i requestÂ `POST`Â cÃ³ chá»©aÂ `Todo`Â lÃªn Ä‘á»‹a chá»‰Â `/addTodo`.

### **POST /addTodo - ThÃªm cÃ´ng viá»‡c vÃ o list**

_WebController.java_

```
    /*
    @ModelAttribute Ä‘Ã¡nh dáº¥u Ä‘á»‘i tÆ°á»£ng Todo Ä‘Æ°á»£c gá»­i lÃªn bá»Ÿi Form Request
     */
@PostMapping("/addTodo")
public String addTodo(@ModelAttribute Todo todo) {
    // ThÃªm Ä‘á»‘i tÆ°á»£ng todo vÃ o list
    todoList.add(todo);
    // Tráº£ vá» trang thÃ nh cÃ´ng success.html
    return "success";
}
```

_success.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/></head><body><h1>To-do</h1><h1>ThÃªm thÃ nh cÃ´ng!</h1><ath:href="@{/listTodo}"class="btn btn-primary">Xem danh sÃ¡ch cÃ´ng viá»‡c</a></body></html>
```

### **Cháº¡y chÆ°Æ¡ng trÃ¬nh.**

Sau khi hoÃ n thiá»‡n xong cÃ¡c pháº§n trÃªn, chÃºng ta sáº½ bá»• sungÂ `index.html`Â vÃ Â `App.java`Â Ä‘á»ƒ khá»Ÿi Ä‘á»™ng server Web

_App.java_

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

_index.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
  <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
  <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1>Todo App</h1><ath:href="@{/listTodo}"class="btn btn-primary">Xem danh sÃ¡ch</a><ath:href="@{/addTodo}"class="btn btn-success">+ ThÃªm cÃ´ng viá»‡c</a></body></html>
```

Khá»Ÿi Ä‘á»™ng á»©ng dá»¥ng vÃ o truy cáº­p vÃ o Ä‘á»‹a chá»‰:Â `http://localhost:8080/`

!image

Nháº¥n vÃ o nÃºtÂ **Xem Danh SÃ¡ch**Â Ä‘á»ƒ Ä‘i tá»›iÂ `GET /listTodo`

!image

Báº¥mÂ **ThÃªm CÃ´ng Viá»‡c**Â Ä‘á»ƒ Ä‘i tá»›i trangÂ `GET /addTodo`

!image

Nháº­p thÃ´ng tin vÃ  báº¥mÂ **Add**Â Ä‘á»ƒ gá»­i thÃ´ng tin tá»›i serverÂ `POST /addTodo`.

Náº¿u thÃ nh cÃ´ng, server sáº½ tráº£ vá» thÃ nh cÃ´ng.

!image

Xem láº¡i danh sÃ¡ch cÃ´ng viá»‡c báº±ng cÃ¡ch báº¥m vÃ oÂ **Xem danh sÃ¡ch cÃ´ng viá»‡c**.

!image

Náº¿u danh sÃ¡ch quÃ¡ nhiá»u, chÃºng ta cÃ³ giá»›i háº¡n báº±ng cÃ¡ch truyá»n lÃªn paramÂ `limit`.

!image

Káº¿t quáº£ chá»‰ cÃ²n 2 viá»‡c pháº£i lÃ m =)))

### **Káº¿t**

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

