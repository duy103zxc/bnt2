[SB14] Restful API + @RestController + @PathVariable + @RequestBody
===================================================================

- Giá»›i thiá»‡u
- @RestController
- @RequestBody
- @PathVariable
- Demo
- CÃ i Ä‘áº·t
- Táº¡o model
- Táº¡o RestController
- Cháº¡y thá»­
- Táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng To-do
- Xem danh sÃ¡ch To-do
- Sá»­a To-do
- Láº¥y thÃ´ng tin To-do
- XÃ³a To-do
- Káº¿t

### **Giá»›i thiá»‡u**

Trong bÃ i trÆ°á»›c, chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu cÃ¡ch lÃ m Web vá»›iÂ **Spring boot**Â vÃ Â **Thymeleaf**. Máº·c dÃ¹ ráº¥t tá»‘t rá»“i, nhÆ°ng Ä‘Ã³ chÆ°a háº³n lÃ  Ä‘iá»ƒm máº¡nh cá»§aÂ **Spring Boot**.

1. [ğŸ“ºSB13] Chi tiáº¿t Spring Boot + Thymeleaf + MySQL + i18n + Web Demo

Hiá»‡n táº¡i xu hÆ°á»›ng hiá»‡n nay lÃ  sáº½ Ä‘á»ƒ cÃ¡c frontend framework take care nhiá»u viá»‡c hÆ¡n, cÃ²n phÃ­a server chá»‰ nÃªn cung cáº¥p API cho frontend framework lÃ  Ä‘á»§.

**Spring boot**Â thÃ¬ láº¡i quÃ¡ máº¡nh cho viá»‡c táº¡o Restful API :3

### **@RestController**

KhÃ¡c vá»›iÂ `@Controller`Â lÃ  sáº½ tráº£ vá» má»™t template.

`@RestController`Â tráº£ vá» dá»¯ liá»‡u dÆ°á»›i dáº¡ng JSON.

```
@RestController
@RequestMapping("/api/v1")
public class RestApiController{

    @GetMapping("/todo")
    public List<Todo> getTodoList() {
        return todoList;
    }
}
```

CÃ¡c Ä‘á»‘i tÆ°á»£ng tráº£ vá» dÆ°á»›i dáº¡ng Object sáº½ Ä‘Æ°á»£cÂ **Spring Boot**Â chuyá»ƒn thÃ nh JSON.

CÃ¡c Ä‘á»‘i tÆ°á»£ng tráº£ vá» ráº¥t Ä‘a dáº¡ng, báº¡n cÃ³ thá»ƒ tráº£ vá»Â `List`,Â `Map`, v.v..Â **Spring Boot**Â sáº½ convert háº¿t chÃºng thÃ nh JSON, máº·c Ä‘á»‹nh sáº½ dÃ¹ng Jackson converter Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³.

Náº¿u báº¡n muá»‘n API tÃ¹y biáº¿n Ä‘Æ°á»£c kiá»ƒu dá»¯ liá»‡u tráº£ vá», báº¡n cÃ³ thá»ƒ tráº£ vá» Ä‘á»‘i tÆ°á»£ngÂ `ResponseEntity`Â cá»§aÂ **Spring**Â cung cáº¥p. ÄÃ¢y lÃ  Ä‘á»‘i tÆ°á»£ng cha cá»§a má»i response vÃ  sáº½ wrapper cÃ¡c object tráº£ vá». CÃ¡i nÃ y báº¡n xem tiáº¿p pháº§n dÆ°á»›i sáº½ rÃµ.

### **@RequestBody**

VÃ¬ bÃ¢y giá» chÃºng ta xÃ¢y dá»±ng API, nÃªn cÃ¡c thÃ´ng tin tá»« phÃ­aÂ **Client**Â gá»­i lÃªnÂ **Server**Â sáº½ náº±m trongÂ `Body`, vÃ  cÅ©ng dÆ°á»›i dáº¡ngÂ `JSON`Â luÃ´n.

```
@RestController
@RequestMapping("/api/v1")
public class RestApiController {

    List<Todo> todoList = new CopyOnWriteArrayList<>();

    @PostMapping("/todo")
    public ResponseEntity addTodo(@RequestBody Todo todo) {
        todoList.add(todo);
        // Tráº£ vá» response vá»›i STATUS CODE = 200 (OK)
        // Body sáº½ chá»©a thÃ´ng tin vá» Ä‘á»‘i tÆ°á»£ng todo vá»«a Ä‘Æ°á»£c táº¡o.
        return ResponseEntity.ok().body(todo);
    }

}
```

Táº¥t nhiÃªn lÃ Â **Spring Boot**Â sáº½ lÃ m giÃºp chÃºng ta cÃ¡c pháº§n náº·ng nhá»c, nÃ³ chuyá»ƒn chuá»—i JSON trong request thÃ nh má»™t Object Java. báº¡n chá»‰ cáº§n cho nÃ³ biáº¿t cáº§n chuyá»ƒn JSON thÃ nh Object nÃ o báº±ng AnnotationÂ `@RequestBody`

### **@PathVariable**

`RESTful API`Â lÃ  má»™t tiÃªu chuáº©n dÃ¹ng trong viá»‡c tháº¿t káº¿ cÃ¡c thiáº¿t káº¿ API cho cÃ¡c á»©ng dá»¥ng web Ä‘á»ƒ quáº£n lÃ½ cÃ¡c resource.

VÃ  vá»›i cÃ¡ch thá»‘ng nháº¥t nÃ y, thÃ¬ sáº½ cÃ³ má»™t pháº§n thÃ´ng tin quan trá»ng sáº½ náº±m ngay trong chÃ­nh URL cá»§a api.

VÃ­ dá»¥:

1. URL táº¡o To-do:Â https://loda.me/todo. TÆ°Æ¡ng á»©ng vá»›i HTTP method lÃ  POST
2. URL láº¥y thÃ´ng tin To-do sá»‘ 12:Â https://loda.me/todo/12. TÆ°Æ¡ng á»©ng vá»›i HTTP method lÃ  GET
3. URL sá»­a thÃ´ng tin To-do sá»‘ 12:Â https://loda.me/todo/12. TÆ°Æ¡ng á»©ng vá»›i HTTP method lÃ  PUT
4. URL xoÃ¡ To-do sá»‘ 12:Â https://loda.me/todo/12. TÆ°Æ¡ng á»©ng vá»›i HTTP method lÃ  DELETE

NgoÃ i thÃ´ng tin trongÂ `Body`Â cá»§a request, thÃ¬ cÃ¡i chÃºng ta cáº§n chÃ­nh lÃ  cÃ¡i con sá»‘ 12 náº±m trong URL. Pháº£i láº¥y Ä‘Æ°á»£c con sá»‘ Ä‘Ã³ thÃ¬ má»›i biáº¿t Ä‘Æ°á»£c Ä‘á»‘i tÆ°á»£ng To-do cáº§n thao tÃ¡c lÃ  gÃ¬.

`@PathVariable`Â tham chiáº¿n.

```
@RestController
@RequestMapping("/api/v1")
public class RestApiController {

    /*
    pháº§n path URL báº¡n muá»‘n láº¥y thÃ´ng tin sáº½ Ä‘á»ƒ trong ngoáº·c kÃ©p {}
     */
    @GetMapping("/todo/{todoId}")
    public Todo getTodo(@PathVariable(name = "todoId") Integer todoId){
        // @PathVariable láº¥y ra thÃ´ng tin trong URL
        // dá»±a vÃ o tÃªn cá»§a thuá»™c tÃ­nh Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong ngoáº·c kÃ©p /todo/{todoId}
        return todoList.get(todoId);
    }
}
```

### **Demo**

ChÃºng ta sáº½ demo má»™t server Rest API Ä‘Æ¡n giáº£n vá»›iÂ **Spring Boot**. CÃ¡c API sáº½ phá»¥c vá»¥ viá»‡c thao tÃ¡c vá»›i Ä‘á»‘i tÆ°á»£ngÂ `To-do`.

Giá»‘ng bÃ i #13Â nhÆ°ng láº§n nÃ y lÃ  API chá»© khÃ´ng pháº£i website.

### **CÃ i Ä‘áº·t**

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.5.RELEASE</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>me.loda.spring</groupId>
    <artifactId>spring-boot-learning</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>spring-boot-learning</name>
    <description>Everything about Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>

        <!--spring mvc, rest-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
        </plugins>
    </build>

</project>
```

Cáº¥u trÃºc thÆ° má»¥c:

!image

### **Táº¡o model**

Sá»­ dá»¥ngÂ LombokÂ cho tiá»‡n nha cÃ¡c báº¡n.

_Todo.java_

```
import lombok.Data;

@Data
public class Todo {
    private String title;
    private String detail;
}
```

### **Táº¡o RestController**

Pháº§n nÃ y ráº¥t dá»…, thayÂ `@Controller`Â thÃ nhÂ `RestController`Â thÃ´i :)) Ä‘Ã¹a Ä‘áº¥y, báº¡n xem code á»Ÿ dÆ°á»›i nháº».

VÃ¬ tÃ´i chá»‰ muá»‘n Demo cÃ¡ch táº¡o API cho cÃ¡c báº¡n, nÃªn chÃºng ta táº¡m bá» qua Database nhÃ© ;)

Báº¡n Ä‘á»ƒ Ã½ 2 Ä‘oáº¡nÂ `@RequestMapping`Â vÃ Â `@PostConstruct`Â nhÃ©!

```
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

/**
 * LÆ°u Ã½, @RequestMapping á»Ÿ class, sáº½ tÃ¡c Ä‘á»™ng tá»›i
 * táº¥t cáº£ cÃ¡c RequestMapping á»Ÿ bÃªn trong nÃ³.
 *
 * Má»i Request á»Ÿ trong method sáº½ Ä‘Æ°á»£c gáº¯n thÃªm prefix /api/v1
 */
@RestController
@RequestMapping("/api/v1")
public class RestApiController {

    private List<Todo> todoList = new CopyOnWriteArrayList<>();

    // báº¡n cÃ²n nhá»› @PostConstruct dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ chá»©?
    // náº¿u khÃ´ng nhá»›, hÃ£y coi láº¡i bÃ i viáº¿t Spring Boot #3 nhÃ©
    @PostConstruct
    public void init(){
        // ThÃªm null vÃ o List Ä‘á»ƒ bá» qua vá»‹ trÃ­ sá»‘ 0;
        todoList.add(null);
    }

    @GetMapping("/todo")
    public List<Todo> getTodoList() {
        return todoList;
    }

    /*
    pháº§n path URL báº¡n muá»‘n láº¥y thÃ´ng tin sáº½ Ä‘á»ƒ trong ngoáº·c kÃ©p {}
     */
    @GetMapping("/todo/{todoId}")
    public Todo getTodo(@PathVariable(name = "todoId") Integer todoId){
        // @PathVariable láº¥y ra thÃ´ng tin trong URL
        // dá»±a vÃ o tÃªn cá»§a thuá»™c tÃ­nh Ä‘Ã£ Ä‘á»‹nh nghÄ©a trong ngoáº·c kÃ©p /todo/{todoId}
        return todoList.get(todoId);
    }

    /*
    @RequestBody nÃ³i vá»›i Spring Boot ráº±ng hÃ£y chuyá»ƒn Json trong request body
    thÃ nh Ä‘á»‘i tÆ°á»£ng Todo
     */
    @PutMapping("/todo/{todoId}")
    public Todo editTodo(@PathVariable(name = "todoId") Integer todoId,
                         @RequestBody Todo todo){
        todoList.set(todoId, todo);
        // Tráº£ vá» Ä‘á»‘i tÆ°á»£ng sau khi Ä‘Ã£ edit
        return todo;    }

    @DeleteMapping("/todo/{todoId}")
    public ResponseEntity deleteTodo(@PathVariable(name = "todoId") Integer todoId){
        todoList.remove(todoId.intValue());
        return ResponseEntity.ok().build();
    }

    @PostMapping("/todo")
    public ResponseEntity addTodo(@RequestBody Todo todo) {
        todoList.add(todo);
        // Tráº£ vá» response vá»›i STATUS CODE = 200 (OK)
        // Body sáº½ chá»©a thÃ´ng tin vá» Ä‘á»‘i tÆ°á»£ng todo vá»«a Ä‘Æ°á»£c táº¡o.
        return ResponseEntity.ok().body(todo);
    }
}
```

### **Cháº¡y thá»­**

_App.java_

```
@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

Server sáº½ on trÃªn port 8080.

BÃ¢y giá» chá»‰ cáº§n Test thÃ´i!

### **Táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng To-do**

```
POSThttp://localhost:8080/api/v1/todo
```

!image

### **Xem danh sÃ¡ch To-do**

```
GEThttp://localhost:8080/api/v1/todo
```

!image

### **Sá»­a To-do**

```
PUThttp://localhost:8080/api/v1/todo/1
```

!image

### **Láº¥y thÃ´ng tin To-do**

```
GEThttp://localhost:8080/api/v1/todo/1
```

!image

### **XÃ³a To-do**

```
DELETEhttp://localhost:8080/api/v1/todo/1
```

!image

### **Káº¿t**

ğŸ’Â Náº¿u cÃ³, toÃ n bá»™ project / code máº«u Ä‘Æ°á»£c lÆ°u trá»¯ táº¡i **GitHub**

ğŸŒŸÂ ÄÃ¢y lÃ  má»™t bÃ i viáº¿t trongÂ Series **LÃ m chá»§ Spring Boot â€“ Zero to Hero**

