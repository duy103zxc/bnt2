[SB13] Chi ti·∫øt Spring Boot + Thymeleaf + MySQL + i18n + Web Demo
===================================================================

The Wayback Machine - https://web.archive.org/web/20230602193235/https://loda.me/articles/sb13-chi-tit-spring-boot-thymeleaf-mysql-i18n-web-demo

![Logo](https://web.archive.org/web/20230602193235im_/https://super-static-assets.s3.amazonaws.com/8a72ee8e-d4aa-4a06-985f-e92802c5bc44/uploads/logo/36872858-1bc0-4117-bb6b-81d9934b5275.svg)

- Home
- Kh√≥a h·ªçc
- #dalog

Created

Oct 27, 2021 3:28 PM

- Gi·ªõi thi·ªáu
- C√†i ƒë·∫∑t
- T·∫°o Database
- C·∫•u h√¨nh ·ª©ng d·ª•ng
- T·∫°o Model
- TodoConfig
- T·∫ßng Repository
- T·∫ßng Service
- T·∫ßng Controller
- Templates
- i18n
- Ch·∫°y th·ª≠ ·ª©ng d·ª•ng
- K·∫øt

### **Gi·ªõi thi·ªáu**

Trong lo·∫°t series v·ªÅ Spring Boot n√†y, ch√∫ng ta ƒë√£ ƒëi qua h·∫øt t·∫•t c·∫£ c√°c ki·∫øn th·ª©c cƒÉn b·∫£n v√† c·∫ßn thi·∫øt.

01. [üìñ\
    \SB1\] H∆∞·ªõng d·∫´n @Component v√† @Autowired
02. [‚òéÔ∏è\
    \SB2\] @Autowired - @Primary - @Qualifier
03. [üö§\
    \SB3\] Spring Bean Life Cycle + @PostConstruct v√† @PreDestroy
04. [üåü\
    \SB4\] @Component vs @Service vs @Repository
05. [üìÉ\
    \SB5\] Component Scan l√† g√¨?
06. [üìπ\
    \SB6\] @Configuration v√† @Bean
07. [üöå\
    \SB7\] Spring Boot Application Config v√† @Value
08. [üìû\
    \SB8\] T·∫°o Web Helloworld v·ªõi @Controller + Thymeleaf
09. [üßµ\
    \SB9\] Gi·∫£i th√≠ch c√°ch Thymeleaf v·∫≠n h√†nh + Expression + Demo Full
10. [üé≤\
    \SB10\] @RequestMapping + @PostMapping + @ModelAttribute + @RequestParam + Web To-Do v·ªõi Thymeleaf
11. [üéé\
    \SB11\] H∆∞·ªõng d·∫´n Spring Boot JPA + MySQL
12. [üé∫\
    \SB12\] Spring JPA Method + @Query

H√¥m nay, ch√∫ng ta s·∫Ω v·∫≠n d·ª•ng to√†n b·ªô ki·∫øn th·ª©c ƒë√£ h·ªçc ƒë·ªÉ t·∫°o ra website qu·∫£n l√Ω c√¥ng vi·ªác b·∫±ng Spring Boot + Thymeleaf + MySQL.

### **C√†i ƒë·∫∑t**

Ch√∫ng ta s·∫Ω c√°c dependencies sau:

1. spring-boot-starter-web
2. lombok
3. spring-boot-starter-thymeleaf
4. spring-boot-starter-data-jpa
5. mysql-connector-java

_pom.xml_

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.5.RELEASE</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>me.loda.spring</groupId>
    <artifactId>spring-boot-learning</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>spring-boot-learning</name>
    <description>Everything about Spring Boot</description>

    <properties>
        <java.version>1.8</java.version>
    </properties>

    <dependencies>
        <!--spring mvc, rest-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>

        <!--spring jpa-->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <!-- mysql connector -->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
        </dependency>

        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
    </dependencies>

    <build>
        <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
        </plugins>
    </build>

</project>
```

C·∫•u tr√∫c th∆∞ m·ª•c:

!image

!image

### **T·∫°o Database**

_script.sql_

```
CREATE SCHEMA IF NOT EXISTS `todo_db` DEFAULT CHARACTER SET utf8mb4 ;

CREATE TABLE IF NOT EXISTS `todo_db`.`todo` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(255) NULL DEFAULT NULL,
  `detail` VARCHAR(255) NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4;
```

Th√™m 1 record v√†o DB

```
INSERT INTO `todo_db`.`todo` (`title`, `detail`) VALUES ('L√†m b√†i t·∫≠p', 'Ho√†n thi·ªán b√†i vi·∫øt Spring Boot #13');
```

Xem th·ª≠ k·∫øt qu·∫£:

!image

### **C·∫•u h√¨nh ·ª©ng d·ª•ng**

C·∫•u h√¨nh l√† ph·∫ßn c·ª±c k√¨ quan tr·ªçng r·ªìi, ch√∫ng ta ph·∫£i cung c·∫•p cho¬†**Spring Boot**¬†c√°c th√¥ng tin v·ªÅ Database v√† Thymeleaf.

Ngo√†i ra, t√πy ch·ªânh m·ªôt s·ªë th√¥ng tin ƒë·ªÉ gi√∫p ch√∫ng ta l·∫≠p tr√¨nh ƒë∆°n gi·∫£n h∆°n.

_application.properties_

```
#Ch·∫°y ·ª©ng d·ª•ng tr√™n port 8085
server.port=8085

# B·ªè t√≠nh nƒÉng cache c·ªßa thymeleaf ƒë·ªÉ l·∫≠p tr√¨nh cho nhanh
spring.thymeleaf.cache=false

# C√°c message tƒ©nh s·∫Ω ƒë∆∞·ª£c l∆∞u t·∫°i th∆∞ m·ª•c i18n
spring.messages.basename=i18n/messages

# B·ªè properties n√†y ƒëi khi deploy
# N√≥ c√≥ t√°c d·ª•ng c·ªë ƒë·ªãnh ng√¥n ng·ªØ hi·ªán t·∫°i ch·ªâ l√† Ti·∫øng Vi·ªát
spring.mvc.locale-resolver=fixed

# M·∫∑c ƒë·ªãnh ng√¥n ng·ªØ l√† ti·∫øng vi·ªát
spring.mvc.locale=vi_VN
# ƒê·ªïi th√†nh ti·∫øng anh b·∫±ng c√°ch b·ªè comment ·ªü d·ª©oi
#spring.mvc.locale=en_US

spring.datasource.url=jdbc:mysql://localhost:3306/todo_db?useSSL=false
spring.datasource.username=root
spring.datasource.password=root

## Hibernate Properties
# The SQL dialect makes Hibernate generate better SQL for the chosen database
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5InnoDBDialect
# Hibernate ddl auto (create, create-drop, validate, update)
spring.jpa.hibernate.ddl-auto = update
```

### **T·∫°o Model**

T·∫°o model¬†`Todo`¬†li√™n k·∫øt t·ªõi b·∫£ng¬†`todo`¬†trong Database.

Ph·∫ßn n√†y ch√∫ng ta s·ª≠ d·ª•ng¬†Lombok](https://web.archive.org/web/20230602193235/https://loda.me/general-huong-dan-su-dung-lombok-giup-code-java-nhanh-hon-69-loda1552789752787)¬†v√†¬†[Hibernate_Todo.java_

```
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

import lombok.Data;

@Entity
@Data
public class Todo {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;
    private String detail;
}
```

Ngo√†i ra, ch√∫ng ta t·∫°o th√™m m·ªôt ƒë·ªëi t∆∞·ª£ng l√†¬†`TodoValidator`, c√≥ tr√°ch nhi·ªám ki·ªÉm tra xem m·ªôt object¬†`Todo`¬†l√† h·ª£p l·ªá hay kh√¥ng.

```
import org.thymeleaf.util.StringUtils;

/*
ƒê·ªëi t∆∞·ª£ng n√†y d√πng ƒë·ªÉ ki·ªÉm tra xem m·ªôt Object Todo c√≥ h·ª£p l·ªá kh√¥ng
 */
public class TodoValidator {

    /**
     * Ki·ªÉm tra m·ªôt object Todo c√≥ h·ª£p l·ªá kh√¥ng
     * @param todo
     * @return
     */
    public boolean isValid(Todo todo) {
        return Optional.ofNullable(todo)
                       .filter(t -> !StringUtils.isEmpty(t.getTitle())) // Ki·ªÉm tra title kh√°c r·ªóng
                       .filter(t -> !StringUtils.isEmpty(t.getDetail())) // Ki·ªÉm tra detail kh√°c r·ªóng
                       .isPresent(); // Tr·∫£ v·ªÅ true n·∫øu h·ª£p l·ªá, ng∆∞·ª£c l·∫°i false
    }
}
```

V·∫≠y l√† xong ph·∫ßn chu·∫©n b·ªã¬†`Model`.

### **TodoConfig**

Trong ·ª©ng d·ª•ng c·ªßa m√¨nh, t√¥i mu·ªën t·ª± t·∫°o ra Bean¬†`TodoValidator`.

ƒê√¢y l√† l√∫c s·ª≠ d·ª•ng¬†`@Configuration`¬†v√†¬†`@Bean`¬†ƒë√£ h·ªçc t·∫°i b√†i¬†Spring Boot #6

_config/TodoConfig.java_

```
@Configuration
public class TodoConfig {
    /**
     * T·∫°o ra Bean TodoValidator ƒë·ªÉ s·ª≠ d·ª•ng sau n√†y
     * @return
     */
    @Bean
    public TodoValidator validator() {
        return new TodoValidator();
    }
}
```

### **T·∫ßng Repository**

T·∫ßng Repository, ch·ªãu tr√°ch nhi·ªám giao ti·∫øp v·ªõi Database. Ch√∫ng ta s·ª≠ d·ª•ng¬†**Spring JPA**.

_repository/TodoRepository.java_

```
@Repository
public interface TodoRepository extends JpaRepository<Todo, Long> {
}
```

### **T·∫ßng Service**

T·∫ßng Service, ch·ªã tr√°ch nhi·ªám th·ª±c hi·ªán c√°c x·ª≠ l√Ω logic, business, h·ªó tr·ª£ cho t·∫ßng Controller.

_service/TodoService.java_

```
@Service
public class TodoService {
    @Autowired
    private TodoRepository todoRepository;

    @Autowired
    private TodoValidator validator;

    /**
     * L·∫•y ra danh s√°ch List<Todo>
     *
     * @param limit - Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng l·∫•y ra
     *
     * @return Tr·∫£ v·ªÅ danh s√°ch List<Todo> d·ª±a theo limit, n·∫øu limit == null th√¨ tr·∫£ findAll()
     */
    public List<Todo> findAll(Integer limit) {
        return Optional.ofNullable(limit)
                       .map(value -> todoRepository.findAll(PageRequest.of(0, value)).getContent())
                       .orElseGet(() -> todoRepository.findAll());
    }

    /**
     * Th√™m m·ªôt Todo m·ªõi v√†o danh s√°ch c√¥ng vi·ªác c·∫ßn l√†m
     *
     * @return Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng Todo sau khi l∆∞u v√†o DB, tr·∫£ v·ªÅ null n·∫øu kh√¥ng th√†nh c√¥ng
     */
    public Todo add(Todo todo) {
        if (validator.isValid(todo)) {
            return todoRepository.save(todo);
        }
        return null;
    }
}
```

### **T·∫ßng Controller**

T·∫ßng Controller, n∆°i ƒë√≥n nh·∫≠n c√°c request t·ª´ ph√≠a ng∆∞·ªùi d√πng, v√† chuy·ªÉn ti·∫øp x·ª≠ l√Ω xu·ªëng t·∫ßng Service.

_controller/TodoController.java_

```
@Controller
public class TodoController {

    @Autowired
    private TodoService todoService;

    /*
    @RequestParam d√πng ƒë·ªÉ ƒë√°nh d·∫•u m·ªôt bi·∫øn l√† request param trong request g·ª≠i l√™n server.
    N√≥ s·∫Ω g√°n d·ªØ li·ªáu c·ªßa param-name t∆∞∆°ng ·ª©ng v√†o bi·∫øn
     */
    @GetMapping("/listTodo")
    public String index(Model model, @RequestParam(value = "limit", required = false) Integer limit) {
        // Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng todoList.
        model.addAttribute("todoList", todoService.findAll(limit));
        // Tr·∫£ v·ªÅ template "listTodo.html"
        return "listTodo";
    }

    @GetMapping("/addTodo")
    public String addTodo(Model model) {
        model.addAttribute("todo", new Todo());
        return "addTodo";
    }

    /*
    @ModelAttribute ƒë√°nh d·∫•u ƒë·ªëi t∆∞·ª£ng Todo ƒë∆∞·ª£c g·ª≠i l√™n b·ªüi Form Request
     */
    @PostMapping("/addTodo")
    public String addTodo(@ModelAttribute Todo todo) {
        return Optional.ofNullable(todoService.add(todo))
                       .map(t -> "success") // Tr·∫£ v·ªÅ success n·∫øu save th√†nh c√¥ng
                       .orElse("failed"); // Tr·∫£ v·ªÅ failed n·∫øu kh√¥ng th√†nh c√¥ng

    }
}
```

### **Templates**

T·∫ßng Controller ƒë√£ tr·∫£ v·ªÅ templates, nhi·ªám v·ª• ti·∫øp theo l√† s·ª≠ d·ª•ng Template Engine ƒë·ªÉ x·ª≠ l√Ω c√°c templates n√†y v√† tr·∫£ v·ªÅ webpage cho ng∆∞·ªùi d√πng.

Template Engine ch√∫ng ta s·ª≠ d·ª•ng s·∫Ω l√†¬†**Thymeleaf**, ƒë√£ h·ªçc t·∫°i c√°c b√†i Spring Boot¬†#8](https://web.archive.org/web/20230602193235/https://loda.me/spring-boot-8-tao-web-helloworld-voi-controller-thymeleaf-loda1558189401113),¬†[#9](https://web.archive.org/web/20230602193235/https://loda.me/spring-boot-9-giai-thich-cach-thymeleaf-van-hanh-expression-demo-full-loda1558267496214),¬†[#10.

_index.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
  <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
  <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1th:text="#{loda.message.hello}"></h1><ath:href="@{/listTodo}"th:text="#{loda.value.viewListTodo}"class="btn btn-primary"></a><ath:href="@{/addTodo}"th:text="#{loda.value.addTodo}"class="btn btn-success"></a></body></html>
```

_listTodo.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
  <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
  <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1th:text="#{loda.value.listTodo} + ':'"></h1><ul><!--Duy·ªát qua to√†n b·ªô ph·∫ßn t·ª≠ trong bi·∫øn "todoList"-->
  <lith:each="todo : ${todoList}"><!--V·ªõi m·ªói ph·∫ßn t·ª≠, l·∫•y ra title v√† detail-->
    <spanth:text="*{todo.getTitle()}"></span> : <spanth:text="*{todo.getDetail()}"></span></li></ul><ath:href="@{/addTodo}"th:text="#{loda.value.addTodo}"class="btn btn-success"></a></body></html>
```

_addTodo.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><!--css-->
  <linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/><!--js-->
  <scriptth:src="@{/js/bootstrap.js}"></script></head><body><h1>To-do</h1><formth:action="@{/addTodo}"th:object="${todo}"method="post"><p>title: <inputtype="text"th:field="*{title}"/></p><p>detail: <inputtype="text"th:field="*{detail}"/></p><p><buttontype="submit"class="btn btn-success">Add</button></p></form></body></html>
```

_success.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/></head><body><h1>To-do</h1><h1 style="color: green"th:text="#{loda.message.success}"></h1><ath:href="@{/listTodo}"th:text="#{loda.value.viewListTodo}"class="btn btn-primary"></a></body></html>
```

_failed.html_

```
<!DOCTYPE html>
<htmlxmlns:th="http://www.thymeleaf.org"><head><metacharset="UTF-8"/><title>Loda To-do</title><metahttp-equiv="Content-Type"content="text/html; charset=UTF-8"/><linkth:href="@{/css/bootstrap.css}"rel="stylesheet"/><linkth:href="@{/css/main.css}"rel="stylesheet"/></head><body><h1>To-do</h1><h1 style="color: red"th:text="#{loda.message.failed}"></h1><ath:href="@{/listTodo}"th:text="#{loda.value.viewListTodo}"class="btn btn-primary"></a></body></html>
```

### **i18n**

Trong c√°c template, t√¥i c√≥ s·ª≠ d·ª•ng c√°c message tƒ©nh, nh·ªØng message n√†y h·ªó tr·ª£ ƒëa ng√¥n ng·ªØ.

Ch√∫ng ta ƒë·ªãnh nghƒ©a c√°c message n√†y t·∫°i th∆∞ m·ª•c¬†`i18n`.

_i18n/messages\_vi.properties_

```
loda.message.hello=Welcome to TodoApp
loda.message.success=Th√™m Todo th√†nh c√¥ng!
loda.message.failed=Th√™m Todo kh√¥ng th√†nh c√¥ng!

loda.value.addTodo=Th√™m c√¥ng vi·ªác
loda.value.viewListTodo=Xem danh s√°ch c√¥ng vi·ªác
loda.value.listTodo=Danh s√°ch c√¥ng vi·ªác
```

_i18n/messages\_en.properties_

```
loda.message.hello=Welcome to TodoApp
loda.message.success=Add To-do Successfully!
loda.message.failed=Add To-do Failed!

loda.value.addTodo=Add To-do
loda.value.viewListTodo=View To-do list
loda.value.listTodo=To-do list
```

### **Ch·∫°y th·ª≠ ·ª©ng d·ª•ng**

Ch·∫°y ·ª©ng d·ª•ng:

_App.java_

```
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class App {
    public static void main(String[] args) {
        SpringApplication.run(App.class, args);
    }
}
```

!image

V√¨ ch√∫ng ta c·∫•u h√¨nh¬†`Locale`¬†l√†¬†`vi`, n√™n ng√¥n ng·ªØ ƒë·ªÅu hi·ªán Ti·∫øng Vi·ªát, r·∫•t tuy·ªát :3

B·∫•m v√†o¬†**Xem danh s√°ch c√¥ng vi·ªác**¬†ƒë·ªÉ t·ªõi¬†`/listTodo`

!image

V√¨ ch√∫ng ta ƒë√£ insert 1 b·∫£n ghi v√†o Database t·ª´ tr∆∞·ªõc, n√™n ·ªü ƒë√¢y n√≥ hi·ªán ra 1 vi·ªác c·∫ßn l√†m.

B·∫•m v√†o¬†**Th√™m c√¥ng vi·ªác**¬†ƒë·ªÉ t·ªõi¬†`/addTodo`

!image

B·∫•m¬†**Add**¬†ƒë·ªÉ l∆∞u th√¥ng tin v√†o Database.

!image

V·∫≠y l√† gi·ªù ch√∫ng ta c√≥ 2 c√¥ng vi·ªác :3

!image

B√¢y gi·ªù gi·∫£ s·ª≠ d·ª•ng ta g·ª≠i l√™n request t·∫°o ra m·ªôt Todo kh√¥ng h·ª£p l·ªá.

`TodoValidator`¬†s·∫Ω tr·∫£ v·ªÅ null -> th√™m th·∫•t b·∫°i

!image

### **K·∫øt**

V·∫≠y l√† ch√∫ng ta ƒë√£ ƒëi ƒë∆∞·ª£c n·ª≠a Series¬†**Spring Boot**.

Trong c√°c ph·∫ßn t·ªõi, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ c√°ch l√†m RestAPI v·ªõi¬†**Spring Boot**, ƒë√¢y m·ªõi l√† ph·∫ßn m·∫°nh m·∫Ω c·ªßa nh·∫•t.

1. [üñäÔ∏è\
\SB14\] Restful API + @RestController + @PathVariable + @RequestBody

üíÅ¬†N·∫øu c√≥, to√†n b·ªô project / code m·∫´u ƒë∆∞·ª£c l∆∞u tr·ªØ t·∫°i **GitHub**

üåü¬†ƒê√¢y l√† m·ªôt b√†i vi·∫øt trong¬†Series **L√†m ch·ªß Spring Boot ‚Äì Zero to Hero**

_N·∫øu b·∫°n ph√°t hi·ªán b√†i vi·∫øt c√≥ l·ªói ho·∫∑c outdated, h√£y b√°o l·∫°i gi√∫p m√¨nh theo email:__loda.namnh@gmail.com__ho·∫∑c qua__Nam Ho√†ng Nguy·ªÖn (facebook.com)_





